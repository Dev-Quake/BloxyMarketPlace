<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Listing | Roblox Marketplace</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- HEADER - EXACT COPY FROM INDEX.HTML -->
    <header>
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">ROBLOX<span>MARKET</span></a>
                
                <nav>
                    <ul>
                        <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
                        <li><a href="store.html"><i class="fas fa-store"></i> Store</a></li>
                        <li><a href="dashboard.html"><i class="fas fa-user"></i> Dashboard</a></li>
                        <li><a href="#" class="active"><i class="fas fa-plus-circle"></i> Create</a></li>
                    </ul>
                </nav>
                
                <div class="auth-buttons">
                    <!-- Dynamic auth buttons from script.js -->
                </div>
            </div>
        </div>
    </header>

    <!-- CREATE LISTING CONTENT -->
    <section class="create-listing" style="margin-top: 120px; padding: 60px 0;">
        <div class="container">
            <div style="max-width: 800px; margin: 0 auto;">
                <!-- Approval Notice -->
                <div class="approval-notice" style="background: rgba(139, 0, 0, 0.1); border: 1px solid #8b0000; border-radius: 10px; padding: 20px; margin-bottom: 40px;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <i class="fas fa-shield-alt" style="font-size: 2rem; color: #8b0000;"></i>
                        <div>
                            <h3 style="color: #f0f0f0; margin-bottom: 5px;">Admin Approval Required</h3>
                            <p style="color: #b0b0b0; font-size: 0.95rem;">
                                All listings are reviewed by our team before appearing on the marketplace. 
                                You'll receive a Discord notification when your listing is approved or rejected.
                            </p>
                        </div>
                    </div>
                </div>

                <h1 class="glitch" data-text="Create New Listing" style="font-size: 2.5rem; margin-bottom: 40px; text-align: center;">Create New Listing</h1>
                
                <form id="listing-form" style="background: rgba(20, 20, 20, 0.8); border: 1px solid #333; border-radius: 10px; padding: 40px;">
                    <!-- Listing Title -->
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label style="display: block; color: #f0f0f0; margin-bottom: 10px; font-weight: 600;">
                            <i class="fas fa-heading"></i> Listing Title *
                        </label>
                        <input type="text" 
                               id="listing-title" 
                               required 
                               placeholder="e.g., Advanced Combat System, GUI Library, Building Service"
                               style="width: 100%; padding: 12px 15px; background: rgba(30, 30, 30, 0.8); border: 1px solid #333; border-radius: 6px; color: #f0f0f0; font-size: 1rem; transition: all 0.3s;">
                    </div>

                    <!-- Listing Type -->
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label style="display: block; color: #f0f0f0; margin-bottom: 10px; font-weight: 600;">
                            <i class="fas fa-tag"></i> Listing Type *
                        </label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <label class="type-option" style="background: rgba(30, 30, 30, 0.8); border: 1px solid #333; border-radius: 6px; padding: 15px; cursor: pointer; transition: all 0.3s; text-align: center;">
                                <input type="radio" name="listing-type" value="asset" style="display: none;">
                                <i class="fas fa-cube" style="font-size: 1.5rem; color: #8b0000; margin-bottom: 10px; display: block;"></i>
                                <div style="color: #f0f0f0; font-weight: 600;">Asset</div>
                                <div style="color: #b0b0b0; font-size: 0.9rem; margin-top: 5px;">Ready-to-use item</div>
                            </label>
                            
                            <label class="type-option" style="background: rgba(30, 30, 30, 0.8); border: 1px solid #333; border-radius: 6px; padding: 15px; cursor: pointer; transition: all 0.3s; text-align: center;">
                                <input type="radio" name="listing-type" value="service" style="display: none;">
                                <i class="fas fa-code" style="font-size: 1.5rem; color: #8b0000; margin-bottom: 10px; display: block;"></i>
                                <div style="color: #f0f0f0; font-weight: 600;">Service</div>
                                <div style="color: #b0b0b0; font-size: 0.9rem; margin-top: 5px;">Custom work/commission</div>
                            </label>
                            
                            <label class="type-option" style="background: rgba(30, 30, 30, 0.8); border: 1px solid #333; border-radius: 6px; padding: 15px; cursor: pointer; transition: all 0.3s; text-align: center;">
                                <input type="radio" name="listing-type" value="freelance" style="display: none;">
                                <i class="fas fa-users" style="font-size: 1.5rem; color: #8b0000; margin-bottom: 10px; display: block;"></i>
                                <div style="color: #f0f0f0; font-weight: 600;">Freelance</div>
                                <div style="color: #b0b0b0; font-size: 0.9rem; margin-top: 5px;">Hire for project</div>
                            </label>
                        </div>
                    </div>

                    <!-- Category -->
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label style="display: block; color: #f0f0f0; margin-bottom: 10px; font-weight: 600;">
                            <i class="fas fa-folder"></i> Category *
                        </label>
                        <select id="listing-category" style="width: 100%; padding: 12px 15px; background: rgba(30, 30, 30, 0.8); border: 1px solid #333; border-radius: 6px; color: #f0f0f0; font-size: 1rem; cursor: pointer;">
                            <option value="">Select a category</option>
                            <option value="scripting">Scripting</option>
                            <option value="building">Building</option>
                            <option value="gui">GUI Design</option>
                            <option value="animation">Animation</option>
                            <option value="plugin">Plugins</option>
                            <option value="model">3D Models</option>
                            <option value="sound">Audio/Sound</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <!-- Price -->
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label style="display: block; color: #f0f0f0; margin-bottom: 10px; font-weight: 600;">
                            <i class="fas fa-dollar-sign"></i> Price (USD) *
                        </label>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <input type="number" 
                                   id="listing-price" 
                                   min="0" 
                                   step="0.01" 
                                   placeholder="0.00"
                                   style="flex: 1; padding: 12px 15px; background: rgba(30, 30, 30, 0.8); border: 1px solid #333; border-radius: 6px; color: #f0f0f0; font-size: 1rem;">
                            <label style="display: flex; align-items: center; gap: 8px; color: #b0b0b0; cursor: pointer;">
                                <input type="checkbox" id="price-negotiable" style="width: 18px; height: 18px;">
                                Negotiable
                            </label>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label style="display: block; color: #f0f0f0; margin-bottom: 10px; font-weight: 600;">
                            <i class="fas fa-align-left"></i> Description *
                        </label>
                        <textarea id="listing-description" 
                                  rows="8" 
                                  required 
                                  placeholder="Describe your listing in detail. Include features, requirements, delivery time, etc."
                                  style="width: 100%; padding: 12px 15px; background: rgba(30, 30, 30, 0.8); border: 1px solid #333; border-radius: 6px; color: #f0f0f0; font-size: 1rem; resize: vertical; font-family: 'Segoe UI', sans-serif;"></textarea>
                    </div>

                    <!-- Discord Contact -->
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label style="display: block; color: #f0f0f0; margin-bottom: 10px; font-weight: 600;">
                            <i class="fab fa-discord"></i> Discord Contact *
                        </label>
                        <div style="background: rgba(30, 30, 30, 0.5); border: 1px solid #333; border-radius: 6px; padding: 15px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-info-circle" style="color: #8b0000;"></i>
                                <div>
                                    <div style="color: #f0f0f0; font-weight: 600;" id="discord-username">Loading your Discord username...</div>
                                    <div style="color: #b0b0b0; font-size: 0.9rem; margin-top: 5px;">
                                        Buyers will contact you directly on Discord. Make sure your DMs are open!
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tags -->
                    <div class="form-group" style="margin-bottom: 40px;">
                        <label style="display: block; color: #f0f0f0; margin-bottom: 10px; font-weight: 600;">
                            <i class="fas fa-tags"></i> Tags
                        </label>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;" id="tags-container">
                            <!-- Tags will be added here -->
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" 
                                   id="tag-input" 
                                   placeholder="Add tags (script, combat, OOP, etc.)"
                                   style="flex: 1; padding: 10px 15px; background: rgba(30, 30, 30, 0.8); border: 1px solid #333; border-radius: 6px; color: #f0f0f0; font-size: 0.95rem;">
                            <button type="button" id="add-tag" class="btn" style="background: #333; color: #f0f0f0; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; transition: all 0.3s;">Add</button>
                        </div>
                    </div>

                    <!-- Form Buttons -->
                    <div style="display: flex; gap: 15px; justify-content: center; margin-top: 40px;">
                        <button type="submit" class="btn btn-primary" style="padding: 15px 40px; font-size: 1.1rem;">
                            <i class="fas fa-paper-plane"></i> Submit for Approval
                        </button>
                        <button type="button" id="save-draft" class="btn btn-secondary" style="padding: 15px 30px; font-size: 1.1rem;">
                            <i class="fas fa-save"></i> Save as Draft
                        </button>
                    </div>
                </form>

                <!-- Preview Modal -->
                <div id="preview-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 9999; overflow-y: auto; padding: 40px 0;">
                    <div class="container" style="max-width: 800px;">
                        <div style="background: rgba(20, 20, 20, 0.95); border: 1px solid #8b0000; border-radius: 10px; padding: 40px; position: relative;">
                            <button id="close-preview" style="position: absolute; top: 20px; right: 20px; background: none; border: none; color: #b0b0b0; font-size: 1.5rem; cursor: pointer;">×</button>
                            
                            <h2 style="font-size: 2rem; margin-bottom: 30px; color: #f0f0f0; text-align: center;">Listing Preview</h2>
                            
                            <div id="preview-content">
                                <!-- Preview content will be inserted here -->
                            </div>
                            
                            <div style="text-align: center; margin-top: 40px;">
                                <button id="confirm-submit" class="btn btn-primary" style="padding: 12px 40px;">
                                    <i class="fas fa-check"></i> Submit for Approval
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FOOTER - EXACT COPY FROM INDEX.HTML -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3 class="logo">ROBLOX<span>MARKET</span></h3>
                    <p class="footer-text">The ultimate marketplace for Roblox creators and developers.</p>
                    <div class="social-links">
                        <a href="#" class="social-link"><i class="fab fa-discord"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-youtube"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-github"></i></a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h4>Marketplace</h4>
                    <ul class="footer-links">
                        <li><a href="store.html">Browse Assets</a></li>
                        <li><a href="create.html">Sell Your Items</a></li>
                        <li><a href="#">Featured</a></li>
                        <li><a href="#">Top Sellers</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Freelance</h4>
                    <ul class="footer-links">
                        <li><a href="#">Find Developers</a></li>
                        <li><a href="#">Post a Job</a></li>
                        <li><a href="#">Freelancer Profiles</a></li>
                        <li><a href="#">Hire Guides</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul class="footer-links">
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Safety & Trust</a></li>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 RobloxMarket. Not affiliated with Roblox Corporation.</p>
                <div class="payment-methods">
                    <i class="fab fa-cc-visa"></i>
                    <i class="fab fa-cc-mastercard"></i>
                    <i class="fab fa-cc-paypal"></i>
                    <i class="fas fa-coins"></i>
                </div>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Type selection styling
            const typeOptions = document.querySelectorAll('.type-option');
            typeOptions.forEach(option => {
                const radio = option.querySelector('input[type="radio"]');
                
                option.addEventListener('click', function() {
                    typeOptions.forEach(opt => {
                        opt.style.borderColor = '#333';
                        opt.style.background = 'rgba(30, 30, 30, 0.8)';
                    });
                    
                    this.style.borderColor = '#8b0000';
                    this.style.background = 'rgba(139, 0, 0, 0.1)';
                    radio.checked = true;
                });
            });

            // Tags functionality
            const tagsContainer = document.getElementById('tags-container');
            const tagInput = document.getElementById('tag-input');
            const addTagBtn = document.getElementById('add-tag');
            const tags = [];

            function addTag(tagText) {
                if (tagText.trim() === '' || tags.length >= 10) return;
                
                const tag = tagText.trim().toLowerCase();
                if (tags.includes(tag)) return;
                
                tags.push(tag);
                
                const tagElement = document.createElement('div');
                tagElement.innerHTML = `
                    <span style="background: rgba(139, 0, 0, 0.2); color: #f0f0f0; padding: 6px 12px; border-radius: 20px; font-size: 0.9rem; display: inline-flex; align-items: center; gap: 8px;">
                        #${tag}
                        <button type="button" class="remove-tag" style="background: none; border: none; color: #b0b0b0; cursor: pointer; font-size: 1rem; padding: 0;">×</button>
                    </span>
                `;
                
                tagElement.querySelector('.remove-tag').addEventListener('click', function() {
                    const index = tags.indexOf(tag);
                    if (index > -1) {
                        tags.splice(index, 1);
                    }
                    tagElement.remove();
                });
                
                tagsContainer.appendChild(tagElement);
                tagInput.value = '';
            }

            addTagBtn.addEventListener('click', () => addTag(tagInput.value));
            tagInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addTag(tagInput.value);
                }
            });

            // Get Discord username from auth
            async function loadDiscordInfo() {
                try {
                    const response = await fetch('/api/user');
                    const data = await response.json();
                    
                    if (data.authenticated && data.user) {
                        const username = data.user.global_name || data.user.username;
                        document.getElementById('discord-username').textContent = `@${username}`;
                    } else {
                        document.getElementById('discord-username').textContent = 'Please login first';
                    }
                } catch (error) {
                    console.error('Failed to load Discord info:', error);
                }
            }

            loadDiscordInfo();

            // Form submission
            document.getElementById('listing-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Show preview
                const previewContent = document.getElementById('preview-content');
                const formData = {
                    title: document.getElementById('listing-title').value,
                    type: document.querySelector('input[name="listing-type"]:checked')?.value,
                    category: document.getElementById('listing-category').value,
                    price: document.getElementById('listing-price').value,
                    negotiable: document.getElementById('price-negotiable').checked,
                    description: document.getElementById('listing-description').value,
                    tags: tags
                };

                previewContent.innerHTML = `
                    <div style="color: #f0f0f0;">
                        <h3 style="color: #8b0000; margin-bottom: 20px;">${formData.title}</h3>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 25px;">
                            <div>
                                <div style="color: #b0b0b0; font-size: 0.9rem; margin-bottom: 5px;">Type</div>
                                <div style="color: #f0f0f0;">${formData.type ? formData.type.charAt(0).toUpperCase() + formData.type.slice(1) : 'Not specified'}</div>
                            </div>
                            <div>
                                <div style="color: #b0b0b0; font-size: 0.9rem; margin-bottom: 5px;">Category</div>
                                <div style="color: #f0f0f0;">${formData.category || 'Not specified'}</div>
                            </div>
                            <div>
                                <div style="color: #b0b0b0; font-size: 0.9rem; margin-bottom: 5px;">Price</div>
                                <div style="color: #f0f0f0;">$${formData.price} ${formData.negotiable ? '(Negotiable)' : ''}</div>
                            </div>
                            <div>
                                <div style="color: #b0b0b0; font-size: 0.9rem; margin-bottom: 5px;">Tags</div>
                                <div style="color: #f0f0f0;">${formData.tags.length > 0 ? formData.tags.map(t => `#${t}`).join(', ') : 'No tags'}</div>
                            </div>
                        </div>
                        <div style="margin-bottom: 25px;">
                            <div style="color: #b0b0b0; font-size: 0.9rem; margin-bottom: 5px;">Description</div>
                            <div style="color: #f0f0f0; background: rgba(30, 30, 30, 0.5); padding: 15px; border-radius: 6px; white-space: pre-line;">${formData.description}</div>
                        </div>
                        <div style="color: #666; font-size: 0.9rem; text-align: center; padding: 20px; border: 1px solid #333; border-radius: 6px;">
                            <i class="fas fa-clock"></i> This listing will be submitted for admin approval and will appear on the marketplace once approved.
                        </div>
                    </div>
                `;

                document.getElementById('preview-modal').style.display = 'block';
            });

            // Close preview
            document.getElementById('close-preview').addEventListener('click', function() {
                document.getElementById('preview-modal').style.display = 'none';
            });

            // Confirm submit
            document.getElementById('confirm-submit').addEventListener('click', async function() {
                const submitBtn = this;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
                submitBtn.disabled = true;

                // Simulate API call
                setTimeout(() => {
                    document.getElementById('preview-modal').style.display = 'none';
                    alert('Listing submitted for approval! You will be notified on Discord when it\'s reviewed.');
                    window.location.href = 'dashboard.html';
                }, 1500);
            });
        });
    </script>
</body>
</html>